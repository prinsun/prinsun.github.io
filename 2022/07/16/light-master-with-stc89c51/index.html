<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
  <link rel="mask-icon" href="/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.makeex.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="闲云潭影日悠悠，物换星移几度秋。阁中帝子今何在？槛外长江空自流。  转眼间又过去了两年有余，时光匆匆，在习惯了被生活拍打向前奔跑的这些日子里，已经很难再挤出感性的文字，似乎从一个诗人变成了一介蛮夫。最近在高温和疫情的双重压迫下，越发觉得需要静下心来，还是要做一个诗人，这样才能写出像诗一样优美的代码呀。不过，在成为真正的诗人之前，请允许我先修炼成 点灯大师。人生路漫漫，难免会走入窄道暗巷，希望在你">
<meta property="og:type" content="article">
<meta property="og:title" content="点灯大师在线点灯之 STC89C51">
<meta property="og:url" content="http://blog.makeex.com/2022/07/16/light-master-with-stc89c51/index.html">
<meta property="og:site_name" content="MakeeX">
<meta property="og:description" content="闲云潭影日悠悠，物换星移几度秋。阁中帝子今何在？槛外长江空自流。  转眼间又过去了两年有余，时光匆匆，在习惯了被生活拍打向前奔跑的这些日子里，已经很难再挤出感性的文字，似乎从一个诗人变成了一介蛮夫。最近在高温和疫情的双重压迫下，越发觉得需要静下心来，还是要做一个诗人，这样才能写出像诗一样优美的代码呀。不过，在成为真正的诗人之前，请允许我先修炼成 点灯大师。人生路漫漫，难免会走入窄道暗巷，希望在你">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/01-stc89-block.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/02-nxp-block.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/03-pz-dev-board.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/04-pz-led.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/05-pz-led-sch.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/06-pz-mcu-sch.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/07-pz-led-con.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/08-pz-ch340-sch.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/09-led-lighting.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/10-rk-grf-1.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/11-rk-grf-2.png">
<meta property="og:image" content="http://blog.makeex.com/images/2022/07/16/12-ch32-addr.png">
<meta property="article:published_time" content="2022-07-16T14:22:22.000Z">
<meta property="article:modified_time" content="2022-07-24T08:00:34.834Z">
<meta property="article:author" content="Makee">
<meta property="article:tag" content="Light Master">
<meta property="article:tag" content="51 单片机">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.makeex.com/images/2022/07/16/01-stc89-block.png">

<link rel="canonical" href="http://blog.makeex.com/2022/07/16/light-master-with-stc89c51/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>点灯大师在线点灯之 STC89C51 | MakeeX</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b46a193b288b66b7eb9dc75b4d74eae6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MakeeX</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/prinsun" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.makeex.com/2022/07/16/light-master-with-stc89c51/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Makee">
      <meta itemprop="description" content="LIFE IS NOT EASY BUT HARD WORK ALWAYS PAYS.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MakeeX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          点灯大师在线点灯之 STC89C51
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-16 22:22:22" itemprop="dateCreated datePublished" datetime="2022-07-16T22:22:22+08:00">2022-07-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Embedded-Development/" itemprop="url" rel="index"><span itemprop="name">Embedded Development</span></a>
                </span>
            </span>

          
            <span id="/2022/07/16/light-master-with-stc89c51/" class="post-meta-item leancloud_visitors" data-flag-title="点灯大师在线点灯之 STC89C51" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">评论总数：</span>
    
    <a title="valine" href="/2022/07/16/light-master-with-stc89c51/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/07/16/light-master-with-stc89c51/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>闲云潭影日悠悠，物换星移几度秋。阁中帝子今何在？槛外长江空自流。</p>
</blockquote>
<p>转眼间又过去了两年有余，时光匆匆，在习惯了被生活拍打向前奔跑的这些日子里，已经很难再挤出感性的文字，似乎从一个诗人变成了一介蛮夫。最近在高温和疫情的双重压迫下，越发觉得需要静下心来，还是要做一个诗人，这样才能写出像诗一样优美的代码呀。不过，在成为真正的诗人之前，请允许我先修炼成 <strong>点灯大师</strong>。人生路漫漫，难免会走入窄道暗巷，希望在你一筹莫展看不清前方时，我这点亮的每一盏灯，能成为你心中的火、眼中的光，再次、再一次找到方向！</p>
<span id="more"></span>

<p>今天对这荒废了很久的博客进行了一些修整，比如：</p>
<ol>
<li>将 <code>hexo</code> 升级到了最新版本</li>
<li>去除了满是广告的畅言评论，换成了 <code>Valine</code>，不太好做数据同步，所以呃..<ul>
<li>所有历史评论全都丢失了</li>
<li>所有文章的浏览统计全部丢失了</li>
</ul>
</li>
<li>将 <code>hexo</code> 的主题 <code>next</code> 升级到了最新版</li>
<li>将头像从金木研换成了陆光 (<em>好像是白头发的我都喜欢</em>)</li>
</ol>
<p>还有一些小的细节调整就不一一列出来了，遗憾的是那些五湖四海网友的评论丢失了，如果你们无意间看到了我的更新，如果你们还记得当初是怎么评论的，可以尝试着帮忙再评论回来的吧（🐶。</p>
<p>在这个系列开篇前，废话似乎有点多了，那么就正式进入点灯大师修炼的第一步吧。</p>
<h2 id="点灯的背景"><a href="#点灯的背景" class="headerlink" title="点灯的背景"></a>点灯的背景</h2><p>所谓的点灯，其实就是在特定的芯片开发板上，点亮板载的 LED 灯，这是嵌入式开发的范畴。最近在 B 站或一些其它平台上，创客类的视频比较火热 (<em>比如稚晖君</em>)，如果能借此机会了解一些基础的嵌入式开发，闲暇时间搞一些小发明，说不定就打开了另外一扇窗呢？并且，我相信这是理工男都喜欢的东西。</p>
<p>在嵌入式开发里，点灯的地位相当于传统应用开发里的 <code>Hello World</code>，如果你是做应用开发的，那么你应该清楚这是怎样重要的一个存在。</p>
<figure class="highlight c"><figcaption><span>以下便是 C 语言的 Hello World</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果只是单纯的将一个小 LED 点亮，那自然是成为不了 <strong>点灯大师</strong> 的，所以，我会在点灯的过程里，再额外阐述些更值得关注的点，让你能点亮灯，又不止是点亮了灯。</p>
<h2 id="STC89C51-简介"><a href="#STC89C51-简介" class="headerlink" title="STC89C51 简介"></a>STC89C51 简介</h2><h3 id="和-51-单片机的关系"><a href="#和-51-单片机的关系" class="headerlink" title="和 51 单片机的关系"></a>和 51 单片机的关系</h3><p>STC89C51 是 STC80C51 单片机的升级版本，而 STC80C51 就是传统意义上的 51 单片机，51 单片机是大多数嵌入式开发的启蒙单片机。古老但简单，可以快速的上手并了解基础的单片机开发套路，所以，从这块板子开始点灯，我觉得是个不错的选择。</p>
<h3 id="STC89-系列参数"><a href="#STC89-系列参数" class="headerlink" title="STC89 系列参数"></a>STC89 系列参数</h3><p>STC 是由宏晶科技推出的一系列芯片，官网地址是：<a target="_blank" rel="noopener" href="http://www.stcmcudata.com/">http://www.stcmcudata.com</a>，当然这官网的布局花哨且杂乱，就不在本篇的讨论范畴了。以下是官方对于 STC89 系列单片机的介绍：</p>
<blockquote>
<p><img data-src="/images/2022/07/16/01-stc89-block.png"></p>
<ol>
<li>增强型 8051 单片机，6 时钟&#x2F;机器周期和 12 时钟&#x2F;机器周期可任意选择，指令代码完全兼容传统 8051</li>
<li>工作电压: 5.5V-3.3V（5V单片机） &#x2F;3.8V-2.0V (<em>3V单片机</em>)</li>
<li><strong>工作频率范围</strong>: 0~40MHZ，相当于普通 8051 的 0～80MHz，实际工作频率可达 48MHz</li>
<li><strong>用户应用程序空间</strong>: 4K&#x2F;8K&#x2F;13K&#x2F;16K&#x2F;32K&#x2F;64K 字节</li>
<li><strong>片上集成 1280 字节或 512 字节 RAM</strong></li>
<li>通用 I&#x2F;O 口 (<em>35&#x2F;39个</em>)<ul>
<li>复位后为: P1&#x2F;P2&#x2F;P3&#x2F;P4 是准双向口&#x2F;弱上拉 (<em>普通 8051 传统 I&#x2F;O 口</em>)</li>
<li>P0 口是开漏输出，作为总线扩展用时，不用加上拉电阻，作为 I&#x2F;O 口用时，需加上拉电阻</li>
</ul>
</li>
<li>ISP(在系统可编程)&#x2F;IAP(在应用可编程)，无需专用编程器，无需专用仿真器可通过串口 (<em>RxD&#x2F;P3.0,TxD&#x2F;P3.1</em>) 直接下载用户程序，数秒即可完成一片</li>
<li>有 EEPROM 功能</li>
<li>看门狗</li>
<li>内部集成 MAX810 专用复位电路 (<em>HD 版本和 90C 版本才有</em>)，外部晶体 20M 以下时，可省外部复位电路</li>
<li>共 3 个 16 位定时器&#x2F;计数器，其中定时器 0 还可以当成 2 个 8 位定时器使用</li>
<li>外部中断 4 路，下降沿中断或低电平触发中断，Power Down 模式可由外部中断低电平触发中断方式唤醒</li>
<li>通用异步串行口 (<em>UART</em>)，还可用定时器软件实现多个 UART</li>
</ol>
</blockquote>
<p>值得关注的是 3、4、5 这三点描述的参数，我这里特意给它加粗了。可以看到相比于应用开发而言，这种单片机的资源要少得可怜，无论是处理器的计算能力、用户程序的大小、程序运行时的内存空间都很的短缺。所以，无论是在编程实现还是产品选型上，这些参数都是需要考虑的点。</p>
<h2 id="开发板简介"><a href="#开发板简介" class="headerlink" title="开发板简介"></a>开发板简介</h2><p>上一小节，我们对 STC89C51 做了一个简单的了解，但光有这块芯片我们是无法点灯的，毕竟只是一块芯片，连灯都没有呀！在嵌入式开发里，我们一般将这种芯片称之为 MCU，当然还有一种可以称之为 MPU 的芯片。</p>
<h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><p>在进入开发板介绍之前，我觉得有必要先了解一些基础概念，这也是成为点灯大师的必经之路。</p>
<h4 id="MPU-和-MCU-的差别"><a href="#MPU-和-MCU-的差别" class="headerlink" title="MPU 和 MCU 的差别"></a>MPU 和 MCU 的差别</h4><p>首先是 MPU、MCU，虽然这两者很多人都混着用，但还是存在一些细微的差别：</p>
<ol>
<li>MPU: 全称是微处理器单元 (<em>Micro Processor Unit</em>)，相比于 MCU 而言，它有更强的计算能力，一般可以运行实时操作系统 (<em>RTOS</em>)，并且可以有内存管理单元 (<em>MMU</em>)</li>
<li>MCU: 全称是微控制器单元 (<em>Mirco Controller Unit</em>)，相比于 MPU 而言，它不能胜任较复杂的计算任务，更多的只是应用于外围设备控制，一般不能运行操作系统，且不会有内存管理单元</li>
</ol>
<p>简而言之，MCU 就是比 MPU 计算及处理能力要弱很多的芯片，但价格便宜呀，所以也会有适用的场景。而，我们的 STC89C51，就是一块 MCU。至于什么是 MMU、什么是 RTOS，以及更多的差异点，后续如果涉及到的话，我们再展开讨论。</p>
<h4 id="SoC-又是什么"><a href="#SoC-又是什么" class="headerlink" title="SoC 又是什么"></a>SoC 又是什么</h4><p>前面讲了 MPU、MCU 这种微芯片，这里又要引出来另外一个概念叫 SoC，SoC 是什么呢？SoC 的全称是片上系统 (<em>System on Chip</em>)。这里我以大家比较熟知的 ARM 处理器来举例，大家有没有想过，很多手机或平板都在号称自己使用的是 ARM 处理器，但同样是 ARM 处理器，为什么会有高通、三星、苹果等等品牌的区别呢？比如高通的骁龙、三星的 Exynos。 这就要将处理器再细分一下了，ARM 公司其实并不实际生产处理器，而是提供处理器的架构设计方案，各个厂商 (<em>比如高通或者三星</em>) 拿到 ARM 公司的设计以及版权后，就可以开始自己的处理器设计，这里的设计并不是对 ARM 的设计进行修改 (<em>应该也是版权不允许的</em>)，而是使用 ARM 架构所预留的接口(<em>或者称之为地址空间</em>)来扩展芯片上的外围设备 (<em>简称芯片外设</em>)，比如加一些控制单元、处理单元等等。这就是片上系统，片上系统所能拓展的外设也很多，比如：GPIO、UART(<em>串口</em>)、I2C、I2S、SPI 等等，这些都称之为芯片的外设(<em>Peripheral</em>)，下图是恩智浦的一款处理器片上系统框图：</p>
<blockquote>
<p><img data-src="/images/2022/07/16/02-nxp-block.png"></p>
</blockquote>
<p>红色框里的，可以说是实际意义上的 CPU，是由 ARM 公司提供，其它所有的框块都是由恩智浦设计实现，最终一起打包生产 (<em>交给台积电这种</em>)，我们最终能看到的就是一个非常小的小黑块。所以像三星、高通、恩智浦这种，一般也称他们为 SoC 厂商，由他们给 CPU 内核增加外设，这样才能产生真正的实用价值。而我们今天使用的 STC89C51 也是类似，只不过它的核心不是使用的 ARM，而是 Intel。</p>
<h4 id="什么是开发板"><a href="#什么是开发板" class="headerlink" title="什么是开发板"></a>什么是开发板</h4><p>讲完了 SoC，再来讲开发板就更容易让人理解了。就像上面所说的，如果 ARM 直接给你一块 ARM 的处理器核心，或者 Intel 给了你一块它的核心，以你一个人的能力，大概率是没法去直接使用的。那如果是 SoC 厂商给了你一块 CPU、MPU、MCU 呢？这个要使用起来就简单了很多，但也不是那么容易，一般情况下你需要先通过 SoC 厂商给的芯片手册了解清楚处理器里的外设，以及电器属性；然后构建最小系统电路，最小电路一般包括下面几个部分(<em>简单看看，现在不了解也无所谓</em>)：</p>
<ul>
<li><strong>电源电路</strong>: 这个很好理解，这个电路就是供电的，没电你的处理器肯定是没法工作的</li>
<li><strong>复位电路</strong>: 可以理解为一个重启按钮，让你的芯片能够正常的重启工作</li>
<li><strong>晶振电路</strong>: 这个并不一定是必须的，有些芯片需要外接晶振提供时钟源才需要 (<em>比如我们今天的这个 STC89C51</em>)</li>
<li><strong>下载电路</strong>: 就是将编写的程序能够下载到指定的地方 (<em>要看芯片启动逻辑而定</em>)，让处理器能够读取运行的</li>
</ul>
<p>有了最小系统电路后，理论上你的芯片就可以工作起来了，但没有灯呀！所以除了最小系统之外，就是看你的需求而定了，要接入哪些板级设备，板级设备就是跟你处理芯片连接在一起的设备，比如我们要接一个 LED 灯，或者接入一个蜂鸣器，又或者接入一块 LCD 显示屏，等等。</p>
<p>等板级设备考虑完成之后，你就可以进行电路设计了，先画原理图，再进行 PCB 设计，然后找厂商进行 PCB 打样，打样的同时你可以并行的购买需要的元器件 (<em>比如我们的 LED 灯</em>)。在收到厂商打样回来的样板之后，你就可以进行元器件焊接工作了，不过焊接一个处理器还是挺有成就感的，是不是？当然不可能全是靠电烙铁进行一个针脚、一个针脚的焊接，焊接这个就不展开了。一切准备就绪后，你就可以进行代码编写了，然后下载到板子上进行测试。都没有问题后，就可以考虑设计个外壳，然后组装起来，这就是一整个使用 SoC 厂商给到的芯片流程了。</p>
<p>是不是觉得流程还是太长了，并且对于初学者而言并不友好，所以这里就引出了另外一个东西，叫 <strong>开发板</strong>。随着 SoC 厂商的芯片复杂度越来越高，想要能够靠一己之力将一块芯片驱动起来已经越来越难，一般情况下 ARM 架构的处理器芯片手册基本都在 4000 页以上，并且有些内容 SoC 厂商也是不会开源的。于是在 SoC 厂商的下游又诞生了另外一个层次：定制方案商或开发板商。SoC 厂商在推出一款新的处理器后，基本也会推出一款对应的示例开发板，所谓开发板就是包含了上述最小系统电路以及部分的板级外设，拿到后插电就可以开发使用的那种。如果是能运行 Linux、Android 这种比较庞大的系统，SoC 厂商还会提供他们移植好的 BootLoader 以及 Android&#x2F;Linux 系统，当然这些 SoC 厂商基本不会直接公开给个人 (<em>部分会在官网提供下载</em>)，但开发板或方案商能拿到这些源码和资料。开发板厂商会参考 SoC 厂商提供的开发板进行定制，要么直接做出各种产品进行售卖 (<em>比如手机、平板、智能音箱等</em>)，要么直接卖大而全的开发板给嵌入式开发者进行学习使用(<em>就是我们这种人了</em>)。SoC 厂商有时候又被称之为原厂，比如在学习 Linux 驱动时，会经常在 <strong>原厂</strong> 提供的设备树基础上进行修改。</p>
<p>既然励志成为点灯大师，那我们先将关注点转移到怎么点灯，而不是怎么造灯。所以，先买一块开发板，下图是我手头上的一块普中开发板：</p>
<p><img data-src="/images/2022/07/16/03-pz-dev-board.png"></p>
<p>这里包括后续使用到的所有开发板，为了避免推销嫌疑，都不会给出购买链接的，我们把注意力集中在点灯上。上图中间那黑色的一条就是 STC89C51 的本尊了，其它都是一些板级外设。这块开发板有一个特点，所有外设都不是直接与 MCU 连接的，而是 MCU 引脚连接到了排针上 (<em>或者叫端子</em>)，外设的引脚也是连接到排针上，所以我们需要使用额外的导线将需要的外设与 MCU 对应的引脚通过排针进行连接，这种设计就比较灵活，我们甚至可以通过导线连接到本身不在开发板上的设备。下图是今天我们需要点亮的 LED 灯所在区域：</p>
<p><img data-src="/images/2022/07/16/04-pz-led.png"></p>
<p>可以看到，这里有好多的灯，并且摆放的很像人行道旁边的红绿灯，我们可以用程序来模拟红绿灯变化情况，不过，这不在本篇的范畴，本篇我们只要点亮一盏灯即可！</p>
<h2 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h2><p>在点灯之前，我们需要看下开发板厂商给我们提供的原理图，确定下要怎样才能将灯点亮，以下就是这块 LED 区域的原理图：</p>
<p><img data-src="/images/2022/07/16/05-pz-led-sch.png"></p>
<p>可以看到这批 LED 灯的一端连接的是 VCC，也就是高电平，另外一端连接到了 J18、J19 两个端子上了，我们要点亮它，只要将 J18、J19 其中任意一个排针给上低电平，就可以亮起来了 (<em>电流从高往低流动起来</em>)。那么怎么给它低电平呢？一般 MCU 的引脚中都包含了一批称之为 GPIO 的引脚，全称就是通用输入输出，这批引脚可以输出高低电平，也可以检测输入的电平高低，当然都是靠编写程序来驱动的。在介绍 STC89C51 时，官方已经给出了这样的说明：</p>
<blockquote>
<ol start="6">
<li>通用 I&#x2F;O 口 (<em>35&#x2F;39个</em>)<ul>
<li>复位后为: P1&#x2F;P2&#x2F;P3&#x2F;P4 是准双向口&#x2F;弱上拉 (<em>普通 8051 传统 I&#x2F;O 口</em>)</li>
<li>P0 口是开漏输出，作为总线扩展用时，不用加上拉电阻，作为 I&#x2F;O 口用时，需加上拉电阻</li>
</ul>
</li>
</ol>
</blockquote>
<p>关于上拉、下拉、推挽、开漏这些电器属性，本篇不作展开，可以自行搜索学习。我们这里知道了，P0&#x2F;P1&#x2F;P2&#x2F;P3&#x2F;P4 这些都是 GPIO 接口 (<em>P4是后续的某些升级板子上才有的，我手头上的这块并没有这个接口</em>)，这样就好办了，还需要再看看原理图，这些 GPIO 口连接到了哪里：</p>
<p><img data-src="/images/2022/07/16/06-pz-mcu-sch.png"></p>
<p>就如前面所说，这些引脚都接到了端子上，值得一提的是上图中还包含了一个复位电路，并且将复位信号也接到了端子上，可以用来扩展其它芯片的复位。那么我们所关注的 GPIO 连接分别是：</p>
<ul>
<li>P0 - J22</li>
<li>P2 - J25</li>
<li>P3 - J29</li>
<li>P1 - J20</li>
</ul>
<p>需要注意的是，这些每一个都是一组 GPIO，每一组包含了 8 个 GPIO，比如 P0 这组就是 P00 - P07，其它类似。所以我们只需要挑选一个引脚即可，这里我们选择 P00，最终是接入到 J22 的 1 号排针上，然后 LED 选择 D1 这个绿色的灯 (<em>不要问为啥选择绿色</em>)，D1 对应的是 J19 的 1 号排针，拿出杜邦线连接后如下图：</p>
<p><img data-src="/images/2022/07/16/07-pz-led-con.png"></p>
<p>硬件准备就绪后，我们下一步就开始准备点灯了！</p>
<h2 id="开始点灯"><a href="#开始点灯" class="headerlink" title="开始点灯"></a>开始点灯</h2><p>在开始编码点灯之前，我们还要准备下开发环境，已经很久不用 Windows 了，那就看看如何基于 MacOS 来搭建点灯环境吧！</p>
<h3 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h3><p>首先我们要安装的肯定是交叉编译器了，要在 MacOS 编译 51 单片机，我们需要安装 SDCC 工具链，可以在以下地址下载安装：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://sdcc.sourceforge.net/">http://sdcc.sourceforge.net/</a></li>
</ul>
<p>安装方式比较简单，这里就不赘述了。安装完工具链，我们还需要能将编译出来的产物下载到开发板中，在 MacOS 上我们可以使用 stcgal 这个工具，相关地址如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/grigorig/stcgal">https://github.com/grigorig/stcgal</a></li>
</ul>
<p>stcgal 是通过 python 来编写的，所以系统中的 python 环境要搭建好。既然要成为点灯大师，我索性重新用 C 写了个原生的下载工具，我将其称之为 burnit，当前阶段只提供了可执行文件，后续等时机成熟了，再一次性开源出来，可以通过以下链接下载：</p>
<ul>
<li>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1UGhY2HXOLwZjZsack-8NZg">https://pan.baidu.com/s/1UGhY2HXOLwZjZsack-8NZg</a> 提取码: mkex</li>
</ul>
<p>命令行的使用方式遵循了大多数 GNU 工具规范， 命令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">❯ ./burnit --help</span><br><span class="line">Usage: burnit [OPTION...] [BINARY FILE]</span><br><span class="line">A tool that can burn MCU on MacOS</span><br><span class="line"></span><br><span class="line"> Serial Port Options:</span><br><span class="line">  -b, --baudrate=&lt;BAUDRATE&gt;  Config serial port baudrate</span><br><span class="line">      --bits=[BITS]          Config serial port bits, default is 8</span><br><span class="line">                             valid option is 5|6|7|8</span><br><span class="line">      --parity=[PARITY]      Config serial port parity, default is &#x27;none&#x27;</span><br><span class="line">                             valid option is &#x27;none&#x27;|&#x27;even&#x27;|&#x27;odd&#x27;</span><br><span class="line">  -p, --port=&lt;PORT&gt;          Config serial port address</span><br><span class="line">      --stopbits=[STOPBITS]  Config serial port stopbits, default is 1</span><br><span class="line">                             valid option is 1|1.5|2</span><br><span class="line"></span><br><span class="line"> Burning Options:</span><br><span class="line">  -a, --address=&lt;ADDR&gt;       Config burn address</span><br><span class="line">  -B, --board=&lt;BOARD&gt;        Config which MCU board to use</span><br><span class="line"></span><br><span class="line"> Misc Options:</span><br><span class="line">  -?, --help                 Give this help list</span><br><span class="line">      --board-supports       Show all supported MCU boards</span><br><span class="line">      --usage                Give a short usage message</span><br><span class="line">  -V, --version              Print program version</span><br></pre></td></tr></table></figure>

<p>该工具只支持串口的方式来下载程序，所以可以看到，大部分都在配置串口相关参数，本次使用的开发板中已经集成了一块 USB 转串口的芯片: CH340G，值得一提的是较新的 MacOS 系统中已经内置了 CH340 驱动，所以无需做额外的驱动安装。原理图如下：</p>
<p><img data-src="/images/2022/07/16/08-pz-ch340-sch.png"></p>
<p>普中在这块的下载电路里还做了一个额外的小设计，可以看到 CH340 的 RTS、DTR 引脚通过限流电阻以及三极管最终连接到了一块场效应管上 (Q3)，并且场效应管和前面的开关电路连接，从而可以通过用程序控制 RTS、DTR 来进行电源开关。STC89 需要开关电源后才能进入下载模式，有了这样的设计，就不需要每次烧录程序的时候手动拨动开关了，当然 stcgal 这个工具里没有适配这样的设计，而我们自己写的这个 burnit 就可以更加轻松的下载程序了。</p>
<h3 id="开始编写程序"><a href="#开始编写程序" class="headerlink" title="开始编写程序"></a>开始编写程序</h3><p>终于到了最关键的一步，我们要写代码来点亮这盏期待已久的 LED 灯了，直接上代码吧：</p>
<figure class="highlight c"><figcaption><span>led.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    __sbit __at (<span class="number">0x80</span>) P0_0;</span><br><span class="line">    P0_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 sdcc 编译该代码：</p>
<pre><code>sdcc led.c -o led.hex
</code></pre>
<p>将编译产生的 led.hex 文件烧录到开发板中，使用我们的 burnit 命令：</p>
<pre><code>./burnit --baudrate 9600 --port /dev/cu.wchusbserial14140 --board stc89 led.hex
</code></pre>
<p>注意：上述命令中 <code>--port</code> 之后的串口地址，需要根据实际情况来定，可以通过 <code>ls /dev/cu.*</code> 来查找正确的开发板串口对应地址。当终端出现以下输出时：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&gt;&gt; writing binary file (106 bytes)...</span><br><span class="line"> 100 % [##################################################]</span><br><span class="line">&gt;&gt; writing binary file done !</span><br><span class="line">&gt;&gt; setting option...</span><br><span class="line">&gt;&gt; setting option done !</span><br><span class="line">&gt;&gt; reset MCU...</span><br><span class="line">&gt;&gt; reset MCU done !</span><br><span class="line">&gt;&gt; disconnected !</span><br></pre></td></tr></table></figure>

<p>标示着整个烧录过程结束，burnit 工具会自动重置开发板，所以这时候这颗 LED 灯应该就亮了起来：</p>
<p><img data-src="/images/2022/07/16/09-led-lighting.png"></p>
<p>这是我为你们点亮的第一盏灯，绿色代表着能够一路畅通无阻，期望迷茫的你能找到绿色指明方向。不过为什么短短 5 行代码，它就亮了起来呢？这是接下来我们要讨论的，也是成为点灯大师必修的基本功!</p>
<h3 id="什么是寄存器"><a href="#什么是寄存器" class="headerlink" title="什么是寄存器"></a>什么是寄存器</h3><p>首先我们要了解清楚的是，什么是寄存器？如果你只做过传统的应用开发，那你了解到的寄存器概念可能是狭义的，传统意义里的寄存器大多是指处理器核心里的寄存器，可以称之为 CPU 寄存器，比如 ARM 的通用寄存器 r0、r1、r2…，Intel 的 eax、ebx、ecx…。前面说过了，SoC 厂商在拿到这些处理器核心后，会开始构建片上系统，也就是基于处理器核心来增加一些额外的处理或控制单元 (<em>比如 GPIO</em>)，那 SoC 的用户怎么使用这些单元呢？也是通过寄存器，SoC 厂商会将这些单元的配置和使用都定义成一系列的寄存器，这就是广义上的寄存器，可以称之为片外寄存器 (<em>片外是相对于处理器核心而言</em>)。因为片外系统需要适应广泛的使用场景，所以一般模块种类和配置方式都很多，因此，SoC 厂商在提供芯片的同时，也会提供对于片外寄存器进行配置使用的描述手册，大多数情况下都会放在数据手册里 (<em>datasheet</em>)，也有直接提供寄存器手册的。这些描述会占据手册的大部分类型，以下是瑞芯微的一款芯片数据手册对于 GPIO 相关寄存器的描述：</p>
<blockquote>
<p><img data-src="/images/2022/07/16/10-rk-grf-1.png"><br><img data-src="/images/2022/07/16/11-rk-grf-2.png"></p>
</blockquote>
<p>可以看到，只是 GPIO 的寄存器就占据了 200 多页的篇幅，所以数据手册只能作为类似于字典来查阅，死记硬背几乎是不可能的事情，也没有必要。那么这些片外寄存器和 CPU 核心是怎么交互的呢？我们虽然知道了这些概念，但到底怎么通过程序来使用它呢？这就要了解下什么是地址了！</p>
<h3 id="什么是地址"><a href="#什么是地址" class="headerlink" title="什么是地址"></a>什么是地址</h3><p>说到地址，应用开发者的第一反应应该就是指针了，指针是什么？指针就是指向某块内存<strong>地址</strong>的变量，我们可以通过指针直接操作某块内存。这里也引入了一个地址的概念，也就是访问指定内存区域的唯一编号，如果再细究一下，这里的地址又可以分为：虚拟地址、物理地址。一般情况下，站在一个高层应用的视角，它所能看到的地址都是虚拟地址，比如 0x02020303，可以简单认为这就是一个哈希表的 <code>key</code>，系统内核的内存管理模块 (<em>一般使用软件或硬件 MMU 实现</em>)，会通过这个 <code>key</code> 查询到一个 <code>value</code>，而这个 <code>value</code> 就是真实要去访问的地址，也就是物理地址。要深入了解虚拟地址的话，就要牵扯到操作系统的相关设计，这个话题也比较庞大，为了和后续我们所讨论的地址区别开，这里只是简单提一下。作为点灯大师，我们关注的，当然是最接近灯的<strong>物理地址</strong>。</p>
<p>要想比较透彻的了解物理地址，我们还是要回过头来看看处理器核心的设计，SoC 厂商在设计处理器核心外设时，最主要关注的就是以下三点：</p>
<ul>
<li><strong>时钟源</strong>: 可以简单理解为 CPU 的心脏，时钟的振动驱动着 CPU 取指、解析、执行<ul>
<li>这里涉及到几个周期的概念：时钟周期、指令周期、机器周期、总线周期，这里就不展开讨论了</li>
</ul>
</li>
<li><strong>地址总线</strong>: 寻址信号线，类似于以往的电话线，寻址就好比喻拨号，拨出一个特定号码后，连接在另一头的特定电话就会被唤起</li>
<li><strong>数据总线</strong>: 用于数据读写的信号线，站在 CPU 的角度而言，就是用于操作对应地址的“内存”</li>
</ul>
<p>那么这里的地址总线上，连接的就是 SoC 厂商所设计的片外模块，通过对模块进行地址分配，地址总线上发出特定的寻址信号时，相应的模块就会感应到自身被呼叫，后续通过数据总线进行数据交换。而模块的地址分配，一般是一个范围的，比如 0x02000000 - 0x0200F00 这个区域是给 I2C 外设、0x03000000 - 0x0300F00 这个区域是给 GPIO 外设等等(<em>这里不是实际数据，地址也不是固定的，要看 SoC 厂商的定义了，只是举个例子</em>)。而每个区域里，又会细分地址，这就是关联到片外寄存器了，每个寄存器都对应了一个实际的物理地址，通过对这个物理地址的操作，就可以直接操作寄存器！以下是某一款 MCU 的地址框图：</p>
<blockquote>
<p><img data-src="/images/2022/07/16/12-ch32-addr.png"></p>
</blockquote>
<p>从图中可以看到，这是一个 32 位的地址空间，外设的地址空间是: 0x4000 0000 - 0x4002 4000；一共有 4 组 GPIO 接口：PortA - PortD，地址空间是: 0x4001 0800 - 0x4001 1800。另外可以看出，作为一个 MCU，很多地址空间都是没有被使用，因为本身的能力决定了它使用不完。这里又无意间引出了另外一个概念: <strong>32 位地址空间</strong> (<em>坑越挖越多呀，感觉今天的灯还要再点一会儿</em>)。</p>
<p>我们常说一个处理是 32 位、64 位，甚至我们今天还说了，STC89 是一个 8 位的处理器，那这个 8 位是指啥呢？是前面我们所说的 32 位的地址总线么？并不是！这里的位数是指数据总线的位数，一般情况下地址总线的位数都是和数据总线相匹配的，但也有例外，比如我们今天所使用的 STC89，虽然数据总线只有 8 位，但地址总线却是 16 位的带宽。我们可以回过头来，看看宏晶所给的 RAM 参数：</p>
<blockquote>
<ol start="5">
<li>片上集成 1280 字节或 512 字节 RAM</li>
</ol>
</blockquote>
<p>大家之前有想过 8 位的处理器为啥 RAM 可以超过 256 字节么？这就是因为它的地址总线是 16 位的，寻址范围是在 64K 以内。通常而言，地址总线的宽度决定的是扩展性，这显而易见，地址越多，所能编码的外设空间就越大；而数据总线的宽度才是真正决定处理器的处理性能，比如 8 位的数据总线，需要分多次才能完成一个 32 位数据的传输，而 32 位宽度的一次性就可以传输完毕。因此，数据总线的宽度，通常就是我们所说的处理器位数。这里还有一个问题是需要解答的，地址总线的寻址范围是有限的，比如 16 位是 0 - 64K，32 位是 0 - 4GB，那么我们这些外设占用了部分的地址编码，那传统意义里的内存怎么办呢？32 位处理器是不是就达不到 4GB 内存了呀？这里就又引出了两种编址方式：</p>
<ol>
<li>独立编址</li>
<li>统一编址</li>
</ol>
<p>相关的，CPU 结构也有两种类型：</p>
<ol>
<li>冯诺依曼结构</li>
<li>哈佛结构</li>
</ol>
<p>关于这两种结构就不展开讨论了，我们主要看看这两种编址方式的差异。从处理器内核的角度而言，所有与外设的交互通道都可以看成 IO 口，IO 口可以连接到 SoC 厂商所设计的各个模块 (<em>比如串口、通用输入输出接口等</em>)，与 IO 所对应的就是<strong>主存单元</strong>，可以理解为就是传统意义里的内存。那么地址总线需要关注的就是这两块: 要寻找的是哪个 IO 口，要操作的是哪块内存，既然是地址总线，当然都是通过地址来定位。</p>
<p><strong>统一编址</strong>就是让 IO 口和主存单元使用同一套地址编码，这样 IO 口就会占用掉部分主存单元的地址空间，也就会导致 32 位的处理器实际主存空间不会达到 4GB。优点是操作 IO 口和操作主存使用同一套内存指令即可，处理器设计上会简单很多。</p>
<p>相对的，<strong>独立编址</strong>就是让 IO 口和主存单元使用独立的地址范围，双方地址可以重合。这种编址方式不会占用主存单元的空间，为了区分是操作 IO 还是主存单元，就需要引入额外的操作指令，处理器的设计上会复杂很多。</p>
<p>另外一点，独立编址和统一编址并不是互斥的，也就是说在一片处理器上，可能存在混用的情况。比如我们所使用的 STC89，像 GPIO、串口这种，称之为特殊功能寄存器 (<em>SFR</em>)，采用的就是统一编址；而片外和片内的 RAM 所采用的就是独立编址。前面也说过，大多数 MCU 的地址空间都是使用不完的，所以大多数的 MCU 都是采用的统一编址，毕竟一块小小的 MCU，你也不可能指望它有多大的主存单元。随着处理器的位数越来越大，统一编址也必然成为首选，毕竟地址空间太多了，比如 64 位的处理器，一般采用的都是 48 位的地址总线，理论上寻址能到 256TB ！</p>
<h3 id="点灯的原理"><a href="#点灯的原理" class="headerlink" title="点灯的原理"></a>点灯的原理</h3><p>最终再回到我们今天所讲的 STC89C51，它的 P0 就是一个特殊功能寄存器，这个寄存器地址是 0x80，STC89C51 的一个寄存器占用的是 8 位，每一位对应一个 GPIO，所以可以推导出 P0 这一组 GPIO 实际的地址:</p>
<ul>
<li>P0.0 - 0x80</li>
<li>P0.1 - 0x81</li>
<li>P0.2 - 0x82</li>
<li>P0.3 - 0x83</li>
<li>P0.4 - 0x84</li>
<li>P0.5 - 0x85</li>
<li>P0.6 - 0x86</li>
<li>P0.7 - 0x87</li>
</ul>
<p>再回到我们这一段点灯代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    __sbit __at (<span class="number">0x80</span>) P0_0;</span><br><span class="line">    P0_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这其中的 <code>__sbit __at (0x80) P0_0</code> 是 SDCC 特有的语法，表示将 P0_0 映射到 0x80 作为一个 <strong>位寄存器</strong>(<em>Bit Register</em>)，所谓的位寄存器估计也只有 51 单片机里有这样的概念了，其实就是代表 P0_0 只能操作一位，也就是只能输入 0 或者 1，0x80 地址对应的就是 P0.0 这个 GPIO，我们将其设置为 0 就代表输出了一个低电平，从而让 LED 灯点亮。相对于位寄存器而言，就有一个叫做<strong>字节寄存器</strong>(<em>Byte Register</em>)的概念，可以使用 <code>__sfr __at (0x80) P0</code> 来定义，如果我们将这个 <code>P0 = 0;</code> 的话，那从 P0.0 - P0.7 全部都会输出低电平，相当于对所有位寄存器进行了一个操作。</p>
<p>除了使用 C 语言来点灯，我们还可以直接使用汇编，这样生成出来的 ihex 文件更小:</p>
<figure class="highlight plaintext"><figcaption><span>led.asm</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.module led</span><br><span class="line">.optsdcc -mmcs51 --model-small</span><br><span class="line"></span><br><span class="line">.area RSEG  (ABS,DATA)</span><br><span class="line">.org 0x0000</span><br><span class="line">    P0_0 = 0x0080</span><br><span class="line"></span><br><span class="line">.area CSEG  (CODE)</span><br><span class="line">    clr P0_0</span><br><span class="line"></span><br><span class="line">_loop:</span><br><span class="line">    sjmp _loop</span><br></pre></td></tr></table></figure>

<p>关于汇编这里就不展开讨论了，有兴趣的可以自行研究，这里说一下编译方法:</p>
<pre><code>sdas8051 -og led.asm
sdld -i led.hex led.rel
</code></pre>
<p>最终将生成的 led.hex 通过我们 burnit 烧入到开发板，依然能看到那颗闪亮的绿灯！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>作为点灯大师修炼的第一步，虽然已经尽量去普及基础概念了，但难免会有遗漏，有必要补充的内容，会在后续点灯的路途里再娓娓道来。那么这第一盏灯带来了哪些收获呢？</p>
<ul>
<li>MCU、MPU </li>
<li>SoC</li>
<li>寄存器</li>
<li>地址</li>
<li>GPIO</li>
</ul>
<p>修行之路是苦涩的，但点灯是快乐的，愿大家能早日点亮心中的那一盏灯。</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/07/24/light-master-with-esp32/" rel="bookmark">点灯大师在线点灯之 ESP32</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Light-Master/" rel="tag"># Light Master</a>
              <a href="/tags/51-%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag"># 51 单片机</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/03/27/review-the-cpp-virtual-method/" rel="prev" title="温习 C++ 的虚函数">
      <i class="fa fa-chevron-left"></i> 温习 C++ 的虚函数
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/24/light-master-with-esp32/" rel="next" title="点灯大师在线点灯之 ESP32">
      点灯大师在线点灯之 ESP32 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9%E7%81%AF%E7%9A%84%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">点灯的背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#STC89C51-%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">STC89C51 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%92%8C-51-%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">2.1.</span> <span class="nav-text">和 51 单片机的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#STC89-%E7%B3%BB%E5%88%97%E5%8F%82%E6%95%B0"><span class="nav-number">2.2.</span> <span class="nav-text">STC89 系列参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%9D%BF%E7%AE%80%E4%BB%8B"><span class="nav-number">3.</span> <span class="nav-text">开发板简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">3.1.</span> <span class="nav-text">基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MPU-%E5%92%8C-MCU-%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="nav-number">3.1.1.</span> <span class="nav-text">MPU 和 MCU 的差别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SoC-%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">3.1.2.</span> <span class="nav-text">SoC 又是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%80%E5%8F%91%E6%9D%BF"><span class="nav-number">3.1.3.</span> <span class="nav-text">什么是开发板</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="nav-number">4.</span> <span class="nav-text">原理图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E7%82%B9%E7%81%AF"><span class="nav-number">5.</span> <span class="nav-text">开始点灯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">5.1.</span> <span class="nav-text">开发环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.2.</span> <span class="nav-text">开始编写程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">5.3.</span> <span class="nav-text">什么是寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9C%B0%E5%9D%80"><span class="nav-number">5.4.</span> <span class="nav-text">什么是地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E7%81%AF%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-number">5.5.</span> <span class="nav-text">点灯的原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Makee"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Makee</p>
  <div class="site-description" itemprop="description">LIFE IS NOT EASY BUT HARD WORK ALWAYS PAYS.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/prinsun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;prinsun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/prinsun" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;prinsun" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Makee</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















    <div id="pjax">
  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'FR2mSA60UEvzmYC24OgbdtvW-gzGzoHsz',
      appKey     : 'L70FAQa4gHBwVkjRwKJGajlx',
      placeholder: "欢迎留言交流...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

    </div>
</body>
</html>
